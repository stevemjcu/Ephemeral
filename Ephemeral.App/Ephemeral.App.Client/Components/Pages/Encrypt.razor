@page "/"
@inject IServiceProvider Services
@inject NavigationManager NavigationManager
@inject IConfiguration Configuration

<PageTitle>Encrypt Secret</PageTitle>

<Submission Label="Encrypt a secret to get a single-use link." Action=EncryptString />

@code {
	private int DefaultLifetimeSeconds => int.Parse(Configuration["DefaultLifetimeSeconds"]!);

	private async Task<string> EncryptString(string plaintext)
	{
		// TODO: Encrypt string

		using var scope = Services.CreateScope();
		var service = scope.ServiceProvider.GetRequiredService<EphemeralService>();

		var id = await service.SecretsPOSTAsync(plaintext, DefaultLifetimeSeconds);
		var uri = new Uri(new(new(NavigationManager.BaseUri), "/decrypt/"), id.ToString());

		return uri.ToString();
	}
}