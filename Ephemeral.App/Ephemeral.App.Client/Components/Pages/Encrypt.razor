@page "/"
@inject IServiceProvider Services
@inject NavigationManager NavigationManager
@inject IConfiguration Configuration

<PageTitle>Encrypt Secret</PageTitle>

<Submission Label="Encrypt a secret to get a single-use link." Action=Action />

@code {
	private async Task<string> Action(string s)
	{
		// TODO: Encrypt string and append decryption key to URI

		var ttl = int.Parse(Configuration["DefaultLifetimeSeconds"]!);

		var service = Services.GetService<EphemeralService>()!;
		var guid = await service.SecretsPOSTAsync(s, ttl);
		var uri = new Uri(new(NavigationManager.BaseUri), guid.ToString());

		return uri.ToString();
	}
}