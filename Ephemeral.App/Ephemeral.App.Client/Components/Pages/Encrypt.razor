@page "/"
@using System.Text
@inject EphemeralApi Api
@inject NavigationManager NavigationManager
@inject IConfiguration Configuration

<PageTitle>Encrypt Secret</PageTitle>

<Submission Label="Encrypt a secret to get a single-use link." Action=Action />

@code {
	private int DefaultLifetimeSeconds => int.Parse(Configuration["DefaultLifetimeSeconds"]!);

	private async Task<string> Action(string input)
	{
		var key = Crypto.GenerateKey();
		var output = Crypto.Encrypt(Encoding.UTF8.GetBytes(input), key); // UTF8 encoded

		var id = await Api.SecretsPOSTAsync(output, DefaultLifetimeSeconds);

		var builder = new UriBuilder()
		{
			Host = NavigationManager.BaseUri,
			Path = $"/decrypt/{id}",
			Fragment = Convert.ToBase64String(key), // Base64 encoded
		};
		return builder.Uri.ToString();
	}
}